import{j as e}from"./index-D9JmXA_p.js";import{r as s,c as r}from"./react-vendor-BnDW3H_d.js";import{b as t,u as i,c as a}from"./query-vendor-DOOTwIbN.js";import{a as n}from"./api-BmK1iuKu.js";import{j as o,F as l,E as c,t as d,z as p,l as m,C as x}from"./ui-vendor-DN-uZ73V.js";const u=e=>{if(!e)return"";if(e.startsWith("http")){if(e.includes("cloudinary.com")){const s=e.includes("?")?"&":"?";return`${e}${s}f_auto,q_auto`}return e}const s="https://medical-shop-backend.vercel.app/api";if(e.startsWith("/api/")){return`${s.replace("/api","")}${e}`}return`${s.replace("/api","")}/${e.replace(/^\//,"")}`},g=()=>{const[g,f]=s.useState(null),[h,b]=s.useState(""),[y,j]=s.useState(""),[v,N]=s.useState(!1),w=t();r();const{data:C,isLoading:P}=i("prescriptions",()=>n.get("/prescriptions").then(e=>e.data)),k=Array.isArray(null==C?void 0:C.data)?C.data:Array.isArray(C)?C:[],z=a(e=>n.delete(`/prescriptions/${e}`),{onSuccess:()=>{w.invalidateQueries("prescriptions"),p.success("Prescription deleted successfully")},onError:()=>{p.error("Failed to delete prescription")}}),$=a(e=>n.post("/prescriptions",e,{headers:{"Content-Type":"multipart/form-data"}}),{onSuccess:()=>{w.invalidateQueries("prescriptions"),p.success("Prescription uploaded successfully!"),f(null),b(""),j(""),setTimeout(()=>{var e;window.scrollTo({top:(null==(e=document.getElementById("prescriptions-list"))?void 0:e.offsetTop)-100,behavior:"smooth"})},100)},onError:e=>{var s,r;const t=(null==(r=null==(s=e.response)?void 0:s.data)?void 0:r.message)||"Failed to upload prescription";p.error(t)}}),D=s=>{const r={Pending:{icon:x,bgColor:"bg-yellow-100",textColor:"text-yellow-800",borderColor:"border-yellow-200",message:"Your prescription is pending verification"},Verified:{icon:m,bgColor:"bg-blue-100",textColor:"text-blue-800",borderColor:"border-blue-200",message:"Your prescription has been verified"},Completed:{icon:m,bgColor:"bg-green-100",textColor:"text-green-800",borderColor:"border-green-200",message:"Your prescription processing is completed"}},t=r[s]||r.Pending,i=t.icon;return e.jsxs("div",{className:`inline-flex items-center space-x-2 px-3 py-1 rounded-full ${t.bgColor} ${t.textColor} ${t.borderColor} border`,children:[e.jsx(i,{size:14}),e.jsx("span",{className:"text-xs font-medium",children:s})]})},S=e=>{const s={Pending:"Your prescription is being verified",Verified:"Your prescription has been verified and is ready",Completed:"Your prescription processing is completed"};return s[e]||s.Pending};return P?e.jsx("div",{className:"flex justify-center items-center min-h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-medical-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Prescriptions"}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Upload New Prescription"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!g)return void p.error("Please select a file");N(!0);const s=new FormData;s.append("prescription",g),s.append("description",h||"Uploaded prescription"),y&&s.append("notes",y);try{await $.mutateAsync(s)}finally{N(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Prescription Image/PDF"}),e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:e=>f(e.target.files[0]),className:"input-field",required:!0}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Supported formats: JPG, PNG, PDF (Max size: 10MB)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description (Optional)"}),e.jsx("input",{type:"text",value:h,onChange:e=>b(e.target.value),placeholder:"e.g., Monthly prescription for diabetes",className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes (Optional)"}),e.jsx("textarea",{value:y,onChange:e=>j(e.target.value),placeholder:"Add any additional notes or instructions...",rows:3,className:"input-field resize-none"})]}),e.jsxs("button",{type:"submit",disabled:v||!g,className:"btn-primary flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(o,{size:16}),e.jsx("span",{children:v?"Uploading...":"Upload Prescription"})]})]})]}),e.jsxs("div",{id:"prescriptions-list",className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Your Prescriptions"}),k&&0!==k.length?e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:k.map(s=>{var r;return e.jsxs("div",{className:"card p-6 hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg mb-4 flex items-center justify-center overflow-hidden",children:"application/pdf"===s.fileType||(null==(r=s.fileType)?void 0:r.includes("pdf"))?e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx(l,{size:48,className:"text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:"PDF Document"})]}):e.jsx("img",{src:u(s.fileUrl),alt:s.description||"Prescription",className:"w-full h-full object-cover rounded-lg",loading:"lazy",decoding:"async",onError:e=>{e.target.parentElement.innerHTML=`\n                          <div class="flex flex-col items-center justify-center space-y-2 p-4">\n                            <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>\n                            </svg>\n                            <span class="text-xs text-gray-500 text-center">Image not available</span>\n                            <a href="${u(s.fileUrl)}" target="_blank" rel="noopener noreferrer" class="text-xs text-medical-600 hover:underline mt-1">View file</a>\n                          </div>\n                        `}})}),e.jsx("div",{className:"mb-3",children:D(s.status||"Pending")}),e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:s.description||"Prescription"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:S(s.status||"Pending")}),e.jsxs("p",{className:"text-xs text-gray-500 mb-4",children:["Uploaded on ",new Date(s.createdAt).toLocaleDateString()]}),s.notes&&e.jsxs("p",{className:"text-sm text-gray-600 mb-4 p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"font-medium",children:"Notes: "}),s.notes]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("a",{href:u(s.fileUrl),target:"_blank",rel:"noopener noreferrer",className:"flex-1 btn-secondary flex items-center justify-center space-x-2",children:[e.jsx(c,{size:16}),e.jsx("span",{children:"View"})]}),e.jsx("button",{onClick:()=>{return e=s._id,void(window.confirm("Are you sure you want to delete this prescription?")&&z.mutate(e));var e},className:"p-2 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",title:"Delete prescription",children:e.jsx(d,{size:16})})]})]},s._id)})}):e.jsxs("div",{className:"text-center py-12 card",children:[e.jsx(l,{size:64,className:"mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No prescriptions uploaded"}),e.jsx("p",{className:"text-gray-600",children:"Upload your prescriptions to get started with easy ordering."})]})]})]})};export{g as default};
