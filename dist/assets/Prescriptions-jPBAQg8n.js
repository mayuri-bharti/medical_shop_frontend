import{j as e}from"./index-D9JmXA_p.js";import{r as s}from"./react-vendor-BnDW3H_d.js";import{b as t,u as r,c as l}from"./query-vendor-DOOTwIbN.js";import{a}from"./api-BmK1iuKu.js";import{Q as i,h as d,F as n,C as o,l as c,U as x,O as m,E as p,X as u,z as g}from"./ui-vendor-DN-uZ73V.js";const h=e=>{if(!e)return"";if(e.startsWith("http"))return e;return`${"https://medical-shop-backend.vercel.app/api".replace("/api","")}/${e.replace(/^\//,"")}`},b=()=>{const[b,j]=s.useState("all"),[f,y]=s.useState(""),[v,N]=s.useState(null),[w,C]=s.useState(!1),[P,k]=s.useState("Pending"),[S,z]=s.useState(""),L=t(),{data:U,isLoading:V,refetch:$}=r(["admin-prescriptions",b],()=>{const e=new URLSearchParams;return"all"!==b&&e.append("status",b),a.get(`/admin/prescriptions?${e.toString()}`).then(e=>e.data)}),A=(null==U?void 0:U.prescriptions)||[],E=l(({id:e,status:s,notes:t})=>a.put(`/admin/prescriptions/${e}/status`,{status:s,notes:t}),{onSuccess:()=>{L.invalidateQueries("admin-prescriptions"),g.success("Prescription status updated successfully"),C(!1),N(null),k("Pending"),z("")},onError:e=>{var s,t;const r=(null==(t=null==(s=e.response)?void 0:s.data)?void 0:t.message)||"Failed to update prescription status";g.error(r)}}),M=s=>{const t={Pending:{icon:o,bgColor:"bg-yellow-100",textColor:"text-yellow-800",borderColor:"border-yellow-200"},Verified:{icon:c,bgColor:"bg-blue-100",textColor:"text-blue-800",borderColor:"border-blue-200"},Completed:{icon:c,bgColor:"bg-green-100",textColor:"text-green-800",borderColor:"border-green-200"}},r=t[s]||t.Pending,l=r.icon;return e.jsxs("div",{className:`inline-flex items-center space-x-2 px-3 py-1 rounded-full ${r.bgColor} ${r.textColor} ${r.borderColor} border`,children:[e.jsx(l,{size:14}),e.jsx("span",{className:"text-xs font-medium",children:s||"Pending"})]})},T=A.filter(e=>{var s,t,r,l,a,i,d,n;if(f){const o=f.toLowerCase();return(null==(t=null==(s=e.user)?void 0:s.name)?void 0:t.toLowerCase().includes(o))||(null==(l=null==(r=e.user)?void 0:r.email)?void 0:l.toLowerCase().includes(o))||(null==(i=null==(a=e.user)?void 0:a.phone)?void 0:i.toLowerCase().includes(o))||(null==(d=e.description)?void 0:d.toLowerCase().includes(o))||(null==(n=e.originalName)?void 0:n.toLowerCase().includes(o))}return!0});return V?e.jsx("div",{className:"flex justify-center items-center min-h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-medical-600"})}):e.jsxs("div",{className:"space-y-5 md:space-y-6 lg:space-y-8",children:[e.jsxs("div",{className:"pb-2",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-gray-900",children:"Prescriptions Management"}),e.jsx("p",{className:"text-gray-600 mt-2 text-sm sm:text-base lg:text-lg",children:"View and manage all user prescriptions"})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-md border border-gray-100 p-4 md:p-5",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{size:20,className:"text-gray-400 flex-shrink-0"}),e.jsx("label",{className:"text-sm md:text-base font-medium text-gray-700 whitespace-nowrap",children:"Status:"})]}),e.jsxs("select",{value:b,onChange:e=>j(e.target.value),className:"flex-1 sm:flex-none px-4 py-2.5 md:py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-medical-500 text-sm md:text-base font-medium",children:[e.jsx("option",{value:"all",children:"All Prescriptions"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Verified",children:"Verified"}),e.jsx("option",{value:"Completed",children:"Completed"})]}),e.jsxs("div",{className:"flex-1 sm:flex-none flex items-center space-x-2 bg-gray-50 rounded-lg px-4 py-2.5 md:py-3 border-2 border-gray-200",children:[e.jsx(d,{size:18,className:"text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by user, description...",value:f,onChange:e=>y(e.target.value),className:"flex-1 bg-transparent border-none outline-none text-sm md:text-base"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 md:gap-5",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-md border border-gray-100 p-4 md:p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:"Total Prescriptions"}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-gray-900 mt-1",children:A.length})]}),e.jsx("div",{className:"bg-blue-100 rounded-lg p-3",children:e.jsx(n,{size:24,className:"text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-md border border-gray-100 p-4 md:p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-yellow-600 mt-1",children:A.filter(e=>"Pending"===e.status).length})]}),e.jsx("div",{className:"bg-yellow-100 rounded-lg p-3",children:e.jsx(o,{size:24,className:"text-yellow-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-md border border-gray-100 p-4 md:p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:"Completed"}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-green-600 mt-1",children:A.filter(e=>"Completed"===e.status).length})]}),e.jsx("div",{className:"bg-green-100 rounded-lg p-3",children:e.jsx(c,{size:24,className:"text-green-600"})})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 md:px-6 py-3 md:py-4 text-left text-xs md:text-sm font-semibold text-gray-700 uppercase tracking-wider",children:"Prescription"}),e.jsx("th",{className:"px-4 md:px-6 py-3 md:py-4 text-left text-xs md:text-sm font-semibold text-gray-700 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-4 md:px-6 py-3 md:py-4 text-left text-xs md:text-sm font-semibold text-gray-700 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 md:px-6 py-3 md:py-4 text-left text-xs md:text-sm font-semibold text-gray-700 uppercase tracking-wider",children:"Uploaded"}),e.jsx("th",{className:"px-4 md:px-6 py-3 md:py-4 text-left text-xs md:text-sm font-semibold text-gray-700 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:0===T.length?e.jsx("tr",{children:e.jsxs("td",{colSpan:"5",className:"px-4 md:px-6 py-12 text-center",children:[e.jsx(n,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"No prescriptions found"})]})}):T.map(s=>{var t,r,l,a,i;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 md:px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center",children:"application/pdf"===s.fileType||(null==(t=s.fileType)?void 0:t.includes("pdf"))?e.jsx(n,{size:20,className:"text-gray-400"}):e.jsx("img",{src:h(s.fileUrl),alt:"Prescription",className:"w-12 h-12 object-cover rounded-lg",onError:e=>{e.target.style.display="none",e.target.parentElement.innerHTML='<svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>'}})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.description||"Prescription"}),e.jsx("p",{className:"text-xs text-gray-500",children:s.originalName})]})]})}),e.jsx("td",{className:"px-4 md:px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{size:16,className:"text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:(null==(r=s.user)?void 0:r.name)||"N/A"}),e.jsx("p",{className:"text-xs text-gray-500",children:(null==(l=s.user)?void 0:l.email)||(null==(a=s.user)?void 0:a.phone)})]})]})}),e.jsx("td",{className:"px-4 md:px-6 py-4",children:M(s.status)}),e.jsx("td",{className:"px-4 md:px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{size:14,className:"text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:(i=s.createdAt,i?new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A")})]})}),e.jsx("td",{className:"px-4 md:px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:h(s.fileUrl),target:"_blank",rel:"noopener noreferrer",className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"View prescription",children:e.jsx(p,{size:16})}),e.jsx("button",{onClick:()=>(e=>{N(e),k(e.status||"Pending"),z(e.notes||""),C(!0)})(s),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Update status",children:e.jsx(c,{size:16})})]})})]},s._id)})})]})})}),w&&v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Update Prescription Status"}),e.jsx("button",{onClick:()=>{C(!1),N(null)},className:"text-gray-400 hover:text-gray-600",children:e.jsx(u,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Status"}),e.jsx("div",{children:M(v.status||"Pending")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Status"}),e.jsxs("select",{value:P,onChange:e=>k(e.target.value),className:"w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-medical-500",children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Verified",children:"Verified"}),e.jsx("option",{value:"Completed",children:"Completed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{value:S,onChange:e=>z(e.target.value),rows:3,placeholder:"Add notes about this prescription...",className:"w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-medical-500 resize-none"})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{onClick:()=>{C(!1),N(null)},className:"flex-1 px-4 py-2 border-2 border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>{v&&E.mutate({id:v._id,status:P,notes:S})},disabled:E.isLoading,className:"flex-1 px-4 py-2 bg-medical-600 text-white rounded-lg font-medium hover:bg-medical-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:E.isLoading?"Updating...":"Update Status"})]})]})]})})]})};export{b as default};
