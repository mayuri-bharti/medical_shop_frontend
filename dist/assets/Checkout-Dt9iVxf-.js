import{g as e,j as s}from"./index-D9JmXA_p.js";import{c as a,f as t,r}from"./react-vendor-BnDW3H_d.js";import{z as l,w as d,x as c,y as n,W as i}from"./ui-vendor-DN-uZ73V.js";import"./query-vendor-DOOTwIbN.js";const o=()=>{const o=a(),[m]=t(),[x,u]=r.useState(!1),[h,g]=r.useState(null),[p,y]=r.useState({name:"",phone:"",street:"",city:"",state:"",pincode:"",landmark:""}),[b,j]=r.useState("COD"),f="https://medical-shop-backend.vercel.app/api";r.useEffect(()=>{const e=m.get("productId"),s=parseInt(m.get("quantity"))||1;e?v(e,s).then(()=>{N();const e=new URLSearchParams(m);e.delete("productId"),e.delete("quantity"),o(`/checkout?${e.toString()}`,{replace:!0})}):N()},[]);const v=async(s,a)=>{try{const t=e();if(!t)return l.error("Please login to continue"),void o("/login");const r=await fetch(`${f}/cart/items`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({productId:s,quantity:a})}),d=await r.json();if(!r.ok||!d.success)throw new Error(d.message||"Failed to add product to cart");l.success("Product added to cart!")}catch(t){l.error(t.message||"Failed to add product to cart")}},N=async()=>{var s,a;try{const s=e();if(!s)return l.error("Please login to continue"),void o("/login?redirect="+encodeURIComponent("/checkout"));const a=await fetch(`${f}/cart`,{headers:{Authorization:`Bearer ${s}`}}),t=await a.json();if(!t.success)throw new Error(t.message||"Failed to fetch cart");g(t.data)}catch(t){l.error("Failed to load cart"),((null==(s=t.message)?void 0:s.includes("401"))||(null==(a=t.message)?void 0:a.includes("unauthorized")))&&o("/login?redirect="+encodeURIComponent("/checkout"))}};return h?0===h.items.length?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-gray-600 mb-4",children:"Your cart is empty"}),s.jsx("button",{onClick:()=>o("/products"),className:"px-4 py-2 bg-medical-600 text-white rounded-lg hover:bg-medical-700",children:"Continue Shopping"})]})}):s.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Checkout"}),s.jsxs("form",{onSubmit:async s=>{s.preventDefault(),u(!0);try{const s=e();if(!s)return l.error("Please login to continue"),void o("/login?redirect="+encodeURIComponent("/checkout"));const a=await fetch(`${f}/orders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({shippingAddress:p,paymentMethod:b})}),t=await a.json();if(!a.ok||!t.success)throw new Error(t.message||"Order failed");l.success("Order placed successfully!"),o("/order-success",{state:{order:t.data}})}catch(a){l.error("Failed to place order")}finally{u(!1)}},className:"grid lg:grid-cols-3 gap-8",children:[s.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[s.jsx(d,{className:"text-medical-600",size:24}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Shipping Address"})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),s.jsx("input",{type:"text",required:!0,value:p.name,onChange:e=>y({...p,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-transparent",placeholder:"Enter your name"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number *"}),s.jsx("input",{type:"tel",required:!0,value:p.phone,onChange:e=>y({...p,phone:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-transparent",placeholder:"9876543210",maxLength:10})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Street Address *"}),s.jsx("input",{type:"text",required:!0,value:p.street,onChange:e=>y({...p,street:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-transparent",placeholder:"House/Flat No., Building Name"})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City *"}),s.jsx("input",{type:"text",required:!0,value:p.city,onChange:e=>y({...p,city:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-transparent",placeholder:"City"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State *"}),s.jsx("input",{type:"text",required:!0,value:p.state,onChange:e=>y({...p,state:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-transparent",placeholder:"State"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pincode *"}),s.jsx("input",{type:"text",required:!0,pattern:"[0-9]{6}",maxLength:6,value:p.pincode,onChange:e=>y({...p,pincode:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-transparent",placeholder:"123456"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Landmark (Optional)"}),s.jsx("input",{type:"text",value:p.landmark,onChange:e=>y({...p,landmark:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-transparent",placeholder:"Near..."})]})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[s.jsx(c,{className:"text-medical-600",size:24}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Payment Method"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("label",{className:"flex items-center space-x-3 p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-medical-500 transition-colors",children:[s.jsx("input",{type:"radio",name:"payment",value:"COD",checked:"COD"===b,onChange:e=>j(e.target.value),className:"text-medical-600"}),s.jsx(n,{size:24}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-gray-900",children:"Cash on Delivery"}),s.jsx("div",{className:"text-sm text-gray-600",children:"Pay when you receive"})]})]}),s.jsxs("label",{className:"flex items-center space-x-3 p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-medical-500 transition-colors",children:[s.jsx("input",{type:"radio",name:"payment",value:"ONLINE",checked:"ONLINE"===b,onChange:e=>j(e.target.value),className:"text-medical-600"}),s.jsx(c,{size:24}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-gray-900",children:"Online Payment"}),s.jsx("div",{className:"text-sm text-gray-600",children:"Debit/Credit Card (Mock)"})]})]}),s.jsxs("label",{className:"flex items-center space-x-3 p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-medical-500 transition-colors",children:[s.jsx("input",{type:"radio",name:"payment",value:"WALLET",checked:"WALLET"===b,onChange:e=>j(e.target.value),className:"text-medical-600"}),s.jsx(i,{size:24}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-gray-900",children:"Wallet"}),s.jsx("div",{className:"text-sm text-gray-600",children:"Paytm/UPI (Mock)"})]})]})]})]}),s.jsx("button",{type:"submit",disabled:x,className:"w-full py-4 bg-medical-600 hover:bg-medical-700 text-white font-semibold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Placing Order...":`Place Order - ₹${h.total}`})]}),s.jsx("div",{className:"lg:col-span-1",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 sticky top-4",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Order Summary"}),s.jsx("div",{className:"space-y-4 mb-6",children:h.items.map((e,a)=>{var t,r,l;return s.jsxs("div",{className:"flex space-x-3",children:[s.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg flex-shrink-0",children:s.jsx("img",{src:(null==(t=e.product)?void 0:t.image)||"/placeholder.jpg",alt:null==(r=e.product)?void 0:r.name,className:"w-full h-full object-cover rounded-lg"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:null==(l=e.product)?void 0:l.name}),s.jsxs("p",{className:"text-sm text-gray-600",children:["Qty: ",e.quantity]}),s.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["₹",(e.price*e.quantity).toLocaleString()]})]})]},a)})}),s.jsxs("div",{className:"border-t pt-4 space-y-2 mb-4",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"Subtotal"}),s.jsxs("span",{className:"text-gray-900",children:["₹",h.subtotal.toLocaleString()]})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"Delivery Fee"}),s.jsx("span",{className:"text-gray-900",children:0===h.deliveryFee?"Free":`₹${h.deliveryFee}`})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"Taxes"}),s.jsxs("span",{className:"text-gray-900",children:["₹",h.taxes.toLocaleString()]})]}),s.jsxs("div",{className:"border-t pt-2 flex justify-between",children:[s.jsx("span",{className:"font-semibold text-gray-900",children:"Total"}),s.jsxs("span",{className:"font-bold text-lg text-gray-900",children:["₹",h.total.toLocaleString()]})]})]}),h.subtotal<499&&s.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 text-sm text-amber-800",children:["Add ₹",(499-h.subtotal).toLocaleString()," more for free delivery"]})]})})]})]})}):s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-medical-600"})})};export{o as default};
